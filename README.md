# zookeeper
zookeeper实现分布式

1.zookeeper是:协调分布式应用的基本服务，它向外部应用暴露一组通用服务 分布式协调工具。

2.应用于:注册中心 发布订阅 负载均衡 分布式锁等

3.数据结构:树桩存储结构 依赖于节点存储(节点名称 节点值/内容) 节点名称不能重复

4.zookeeper节点类型:持久节点(存在硬盘上),临时节点(断开连接后就没了) 持久顺序节点 临时顺序节点

5.节点的watch:当节点改变时会产生事件

6.
分布式锁:多个JVM操作数据,保证数据的唯一性
分布式锁实现方式:
数据库实现分布式锁 基于缓存（redis，memcached）实现分布式锁 基于Zookeeper实现分布式锁

数据库实现,创建一张锁表 锁住某个方法或资源时，我们就在该表中增加一条记录，想要释放锁的时候就删除这条记录。
缺点:性能差、线程出现异常时直接报错，后续线程竟不来,容易出现死锁

redis实现:使用setnx加锁，并使用expire命令为锁添加一个超时时间，超过该时间则自动释放锁，锁的value值为一个随机生成的UUID，通过此在释放锁的时候进行判断。释放锁的时候，通过UUID判断是不是该锁，若是该锁，则执行delete进行锁释放。
缺点:锁的失效时间难控制、容易产生死锁、非阻塞式、不可重入
https://www.cnblogs.com/liuyang0/p/6744076.html
zk实现:在加锁时会在zk上创建相同临时节点,谁能创建节点就能加锁,其他的等待,到锁使用完释放,通过watch事件监听通知其他节点加锁(如果临时节点存在就等待)
优点:实现相对简单、可靠性强、使用临时节点，失效时间容易控制
